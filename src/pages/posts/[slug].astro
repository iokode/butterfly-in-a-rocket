---
import {getCollection} from "astro:content";
import PostLayout from "../../layouts/PostLayout.astro";
import {Markdown} from 'astro-remote';
import Comments from "../../components/Comments.svelte";
import Alert from "../../components/Entry/Alert.astro";
import XPost from "../../components/Entry/XPost.astro";
import Message from "../../components/Entry/Message.astro";
import YouTube from "../../components/Entry/YouTube.astro";

const allowedComponents = {Alert, Message, XPost, YouTube};

export const getStaticPaths = async function () {
    const entries = await getCollection('entries');

    return entries.map(entry => {
        return {
            params: {slug: entry.data.slug},
            props: {
                entry: entry,
            }
        }
    })
};
---
<PostLayout {...(Astro.props.entry.data as any)}>
    <Markdown content={Astro.props.entry.data.body} sanitize={{allowComponents: true}} components={allowedComponents}/>

    <Comments client:visible discussionId={Astro.props.entry.data.discussionId} author={Astro.props.entry.data.author} />
</PostLayout>