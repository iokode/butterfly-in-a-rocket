---
import {getCollection} from "astro:content";
import Layout from "../../layouts/Layout.astro";

type PostsByYear = {
    [year: string]: typeof posts[0][]; // Keys are years, values are arrays of posts.
};

const posts = (await getCollection('spanishLegacyEntries')).sort(
    (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);

let postsByYear = posts.reduce<PostsByYear>((accumulator, post) => {
    const year = new Date(post.data.publishDate).getFullYear();
    if (!accumulator[year]) {
        accumulator[year] = [];
    }
    accumulator[year].push(post);
    return accumulator;
}, {});
---

<Layout title="Spanish legacy entries archive">
    <h1>Spanish legacy entries archive</h1>
    {Object.entries(postsByYear).reverse().map(([year, yearPosts]) => (
            <section>
                <h2>{year}</h2>
                <ul>
                    {yearPosts.map(post => (
                            <li>
                                <a href={`/posts/legacy/${post.data.slug}`}>{post.data.title}</a> <small>by <a target="_blank" href={`https://github.com/montyclt`}>Ivan Montilla</a></small>
                            </li>
                    ))}
                </ul>
            </section>
    ))}
</Layout>